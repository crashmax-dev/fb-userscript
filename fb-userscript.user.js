// ==UserScript==
// @name        fb-userscript
// @version     0.1.0
// @license     MIT
// @homepage    https://crashmax-dev.github.io/fb-userscript/
// @match       https://crashmax-dev.github.io/fb-userscript/*
// @match       http://localhost:3000/*
// @match       https://review.intern.facebook.com/*
// @grant       GM_addStyle
// @updateURL   https://crashmax-dev.github.io/fb-userscript/fb-userscript.meta.js
// @downloadURL https://crashmax-dev.github.io/fb-userscript/fb-userscript.user.js
// ==/UserScript==

var ue=Object.defineProperty,le=(c,m,y)=>m in c?ue(c,m,{enumerable:!0,configurable:!0,writable:!0,value:y}):c[m]=y,v=(c,m,y)=>(le(c,typeof m!="symbol"?m+"":m,y),y),A=(c,m,y)=>{if(!m.has(c))throw TypeError("Cannot "+y)},M=(c,m,y)=>(A(c,m,"read from private field"),y?y.call(c):m.get(c)),B=(c,m,y)=>{if(m.has(c))throw TypeError("Cannot add the same private member more than once");m instanceof WeakSet?m.add(c):m.set(c,y)},z=(c,m,y,x)=>(A(c,m,"write to private field"),x?x.call(c,y):m.set(c,y),y);(function(){var c;function m(o,e,...i){const t=document.createElement(o);return typeof e=="string"?t.append(y(e)):Array.isArray(e)?t.append(...e):(Object.assign(t,e),Object.assign(t.style,e?.style)),i.length&&t.append(...i),t}function y(o){return document.createTextNode(o)}function x(o,e,i){const t=new MutationObserver((n,r)=>{for(const s of n)e(s,r)});return t.observe(o,{childList:!0,subtree:!0,...i}),t}class j{constructor(){B(this,c,{})}on(e,i){const t=M(this,c)[e];return t?t.push(i):M(this,c)[e]=[i],this}addListener(e,i){return this.on(e,i)}once(e,i){const t=(...n)=>{this.off(e,t),i(...n)};return this.on(e,t),this}emit(e,...i){const t=M(this,c)[e]||[];for(let n=0;n<t.length;n++)t[n](...i);return Boolean(t.length)}off(e,i){return M(this,c)[e]&&(M(this,c)[e]=M(this,c)[e].filter(t=>t!==i)),this}removeListener(e,i){return this.off(e,i)}removeAllListeners(e){return e?delete M(this,c)[e]:z(this,c,{}),this}eventNames(){return Reflect.ownKeys(M(this,c))}listeners(e){return M(this,c)[e]}listenerCount(e){var i;return((i=M(this,c)[e])==null?void 0:i.length)??0}}c=new WeakMap;const E=new j;class R{constructor(){v(this,"submitButtonObserver")}addButtonObserver(e){this.submitButtonObserver=x(e,i=>{const t=i.target;t.ariaDisabled!=="true"&&(t.click(),E.emit("timer_end"),this.unmount())},{attributes:!0})}mount(){x(document.body,(e,i)=>{var t,n;if(this.submitButtonObserver)return;const r=document.evaluate("//div[contains(text(), 'Submit')]",document,null,XPathResult.ANY_TYPE,null).iterateNext();if(!r)return;const s=(n=(t=r.parentNode)==null?void 0:t.parentNode)==null?void 0:n.parentElement;s&&s.ariaLabel==="Submit"&&(this.addButtonObserver(s),E.emit("timer_start"))})}unmount(){this.submitButtonObserver&&(this.submitButtonObserver.disconnect(),this.submitButtonObserver=null)}}var P=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function U(o){return o&&o.__esModule&&Object.prototype.hasOwnProperty.call(o,"default")?o.default:o}var S={exports:{}};(function(o,e){(function(i,t){o.exports=t()})(P,function(){return function(i){function t(r){if(n[r])return n[r].exports;var s=n[r]={exports:{},id:r,loaded:!1};return i[r].call(s.exports,s,s.exports,t),s.loaded=!0,s.exports}var n={};return t.m=i,t.c=n,t.p="",t(0)}([function(i,t,n){function r(u){return u&&u.__esModule?u:{default:u}}var s=n(1),d=r(s);i.exports=d.default},function(i,t,n){function r(l,a){if(!(l instanceof a))throw new TypeError("Cannot call a class as a function")}function s(){var l=this,a=this.el,f=this.opts||h,T={};if(a.style.position="absolute",this.handle=f.handle||a,f.constrain){for(var b=f.relativeTo||a.parentNode,w=a,L=0,I=0;w!==b;)w=w.parentNode,(0,d.isRelative)(w)&&(L-=w.offsetLeft,I-=w.offsetTop),w===b&&(L+=w.offsetLeft,I+=w.offsetTop);var oe=L+b.offsetWidth-a.offsetWidth,re=I+b.offsetHeight-a.offsetHeight;T.xClamp=(0,d.generateClamp)(L,oe),T.yClamp=(0,d.generateClamp)(I,re)}this.opts=f,this.data=T,this.events={mousedown:u.mousedown.bind(this),mouseup:u.mouseup.bind(this),touchstart:u.touchstart.bind(this),touchstop:u.touchstop.bind(this),scrollFix:function(ae){l.isDragging&&ae.preventDefault()}},this.handleMove=g(this.opts.customMove),this.handle.addEventListener("mousedown",this.events.mousedown,!1),this.handle.addEventListener("touchstart",this.events.touchstart,!1),document.addEventListener("touchmove",this.events.scrollFix,{passive:!1})}Object.defineProperty(t,"__esModule",{value:!0});var d=n(2),u=n(3),g=(0,d.generateMoveFn)(),h={constrain:!1,relativeTo:null,handle:null,ignoreFn:null,highlightInputs:!1,onMouseDown:null,onMouseMove:null,onMouseUp:null,onTouchStart:null,onTouchMove:null,onTouchStop:null,customMove:null},p=function(){function l(a,f){if(r(this,l),!a)throw Error("Must include moveable element");this.el=a,this.opts=f,s.call(this)}return l.prototype.reinit=function(){this.destroy(),s.call(this)},l.prototype.destroy=function(){var a=this.events;this.handle.removeEventListener("mousedown",a.mousedown,!1),document.removeEventListener("mousemove",a.mousemove,!1),document.removeEventListener("mouseup",a.mouseup,!1),this.handle.removeEventListener("touchstart",a.touchstart,!1),document.removeEventListener("touchmove",a.touchmove,!1),document.removeEventListener("touchstop",a.touchstop,!1),document.removeEventListener("touchmove",this.events.scrollFix,{passive:!1})},l}();t.default=function(l,a){return new p(l,a)}},function(i,t){function n(u,g){return function(h){return Math.min(Math.max(h,u),g)}}function r(u){return window.getComputedStyle(u).position==="relative"}function s(){return window.requestAnimationFrame?function(u){var g=u||d;return function(h,p,l){window.requestAnimationFrame(function(){g(h,p,l)})}}:function(u){return function(g,h,p){var l=u||d;l(g,h,p)}}}function d(u,g,h){u.style.left=g+"px",u.style.top=h+"px"}Object.defineProperty(t,"__esModule",{value:!0}),t.generateClamp=n,t.isRelative=r,t.generateMoveFn=s},function(i,t){function n(h){var p=this.opts;if(p.highlightInputs){var l=h.target.tagName.toLowerCase();if(l==="input"||l==="textarea")return}if(!p.ignoreFn||!p.ignoreFn(h)){if(h.button===0){var a=this.el,f=this.events;typeof p.onMouseDown=="function"&&p.onMouseDown(a,h);var T=h.clientX-a.offsetLeft,b=h.clientY-a.offsetTop;f.mousemove=r.bind(this,T,b),document.addEventListener("mousemove",f.mousemove,!1),document.addEventListener("mouseup",f.mouseup,!1)}h.preventDefault()}}function r(h,p,l){var a=this.el,f=this.opts,T=this.data;typeof f.onMouseMove=="function"&&f.onMouseMove(a,l);var b=l.clientX-h,w=l.clientY-p;return f.constrain&&(b=T.xClamp(b),w=T.yClamp(w)),this.handleMove(a,b,w),l.preventDefault(),!1}function s(h){var p=this.el,l=this.opts,a=this.events;typeof l.onMouseUp=="function"&&l.onMouseUp(p,h),document.removeEventListener("mouseup",a.mouseup,!1),document.removeEventListener("mousemove",a.mousemove,!1)}function d(h){var p=this.opts;if(p.highlightInputs){var l=h.target.tagName.toLowerCase();if(l==="input"||l==="textarea")return}if(!p.ignoreFn||!p.ignoreFn(h)){var a=this.el,f=this.events;typeof p.onTouchStart=="function"&&p.onTouchStart(a,h);var T=h.targetTouches[0],b=T.clientX-a.offsetLeft,w=T.clientY-a.offsetTop;f.touchmove=u.bind(this,b,w),this.isDragging=!0,document.addEventListener("touchmove",f.touchmove,!1),document.addEventListener("touchend",f.touchstop,!1),document.addEventListener("touchcancel",f.touchstop,!1)}}function u(h,p,l){var a=this.el,f=this.opts,T=this.data;typeof f.onTouchMove=="function"&&f.onTouchMove(a,l);var b=l.targetTouches[0],w=b.clientX-h,L=b.clientY-p;return f.constrain&&(w=T.xClamp(w),L=T.yClamp(L)),this.handleMove(a,w,L),l.preventDefault(),!1}function g(h){this.isDragging=!1;var p=this.el,l=this.opts,a=this.events;typeof l.onTouchStop=="function"&&l.onTouchStop(p,h),document.removeEventListener("touchmove",a.touchmove,!1),document.removeEventListener("touchend",a.touchstop,!1),document.removeEventListener("touchcancel",a.touchstop,!1)}Object.defineProperty(t,"__esModule",{value:!0}),t.mousedown=n,t.mousemove=r,t.mouseup=s,t.touchstart=d,t.touchmove=u,t.touchstop=g}])})})(S);const X=U(S.exports);class V{constructor(...e){v(this,"target"),v(this,"displace"),v(this,"options");var i;this.target=((i=this.options)==null?void 0:i.handle)??e[0],this.options=e[1],this.displace=X(...e),this.destroy(),this.reinit=this.reinit.bind(this);const t=()=>{this.displace.reinit(),this.target.removeEventListener("mouseenter",t)};this.target.addEventListener("mouseenter",t),window.addEventListener("resize",this.reinit)}reinit(){this.displace.reinit()}destroy(){this.displace.destroy(),window.removeEventListener("resize",this.reinit)}changePosition(e,i){this.target.style.left=`${e}px`,this.target.style.top=`${i}px`}}class W{constructor(e,i,t,n){v(this,"serialize"),v(this,"deserialize"),this.key=e,this.initialValue=i,this.storage=t,this.serialize=r=>n!=null&&n.serialize?n.serialize(r):JSON.stringify(r),this.deserialize=r=>n!=null&&n.deserialize?n.deserialize(r):JSON.parse(r)}get values(){try{const e=this.storage.getItem(this.key);return e?this.deserialize(e):this.initialValue}catch{return this.initialValue}}write(e){e instanceof Function&&(e=e(this.values));try{this.storage.setItem(this.key,this.serialize(e))}catch(i){return console.error(`Failed to save (${this.key}):`,i.message),this.initialValue}return e}reset(){this.write(this.initialValue)}}class Y extends W{constructor(e,i,t){super(e,i,localStorage,t)}}class ${constructor(){v(this,"el"),v(this,"interact"),v(this,"store",new Y("overlay-position",{x:0,y:0}))}mount(e){this.el=m("div",{className:"overlay"},e),this.interact=new V(e,{constrain:!0,relativeTo:this.el,handle:e,onMouseDown:()=>{this.el.classList.add("grabbing")},onMouseUp:n=>{this.el.classList.remove("grabbing");const{x:r,y:s}=n.getBoundingClientRect();this.store.write({x:r,y:s})}});const{x:i,y:t}=this.store.values;this.interact.changePosition(i,t),document.body.appendChild(this.el)}}const G=o=>(e,i)=>(o.set(e,i),i),k=Number.MAX_SAFE_INTEGER===void 0?9007199254740991:Number.MAX_SAFE_INTEGER,O=536870912,C=O*2,q=(o,e)=>i=>{const t=e.get(i);let n=t===void 0?i.size:t<C?t+1:0;if(!i.has(n))return o(i,n);if(i.size<O){for(;i.has(n);)n=Math.floor(Math.random()*C);return o(i,n)}if(i.size>k)throw new Error("Congratulations, you created a collection of unique numbers which uses all available integers!");for(;i.has(n);)n=Math.floor(Math.random()*k);return o(i,n)},N=new WeakMap,H=G(N),_=q(H,N),J=o=>o.method!==void 0&&o.method==="call",K=o=>o.error===null&&typeof o.id=="number",D=((o,e)=>{let i=null;return()=>{if(i!==null)return i;const t=new Blob([e],{type:"application/javascript; charset=utf-8"}),n=URL.createObjectURL(t);return i=o(n),setTimeout(()=>URL.revokeObjectURL(n)),i}})(o=>{const e=new Map([[0,()=>{}]]),i=new Map([[0,()=>{}]]),t=new Map,n=new Worker(o);return n.addEventListener("message",({data:r})=>{if(J(r)){const{params:{timerId:s,timerType:d}}=r;if(d==="interval"){const u=e.get(s);if(typeof u=="number"){const g=t.get(u);if(g===void 0||g.timerId!==s||g.timerType!==d)throw new Error("The timer is in an undefined state.")}else if(typeof u<"u")u();else throw new Error("The timer is in an undefined state.")}else if(d==="timeout"){const u=i.get(s);if(typeof u=="number"){const g=t.get(u);if(g===void 0||g.timerId!==s||g.timerType!==d)throw new Error("The timer is in an undefined state.")}else if(typeof u<"u")u(),i.delete(s);else throw new Error("The timer is in an undefined state.")}}else if(K(r)){const{id:s}=r,d=t.get(s);if(d===void 0)throw new Error("The timer is in an undefined state.");const{timerId:u,timerType:g}=d;t.delete(s),g==="interval"?e.delete(u):i.delete(u)}else{const{error:{message:s}}=r;throw new Error(s)}}),{clearInterval:r=>{const s=_(t);t.set(s,{timerId:r,timerType:"interval"}),e.set(r,s),n.postMessage({id:s,method:"clear",params:{timerId:r,timerType:"interval"}})},clearTimeout:r=>{const s=_(t);t.set(s,{timerId:r,timerType:"timeout"}),i.set(r,s),n.postMessage({id:s,method:"clear",params:{timerId:r,timerType:"timeout"}})},setInterval:(r,s)=>{const d=_(e);return e.set(d,()=>{r(),typeof e.get(d)=="function"&&n.postMessage({id:null,method:"set",params:{delay:s,now:performance.now(),timerId:d,timerType:"interval"}})}),n.postMessage({id:null,method:"set",params:{delay:s,now:performance.now(),timerId:d,timerType:"interval"}}),d},setTimeout:(r,s)=>{const d=_(i);return i.set(d,r),n.postMessage({id:null,method:"set",params:{delay:s,now:performance.now(),timerId:d,timerType:"timeout"}}),d}}},`(()=>{"use strict";const e=new Map,t=new Map,r=(e,t)=>{let r,o;const i=performance.now();r=i,o=e-Math.max(0,i-t);return{expected:r+o,remainingDelay:o}},o=(e,t,r,i)=>{const s=performance.now();s>r?postMessage({id:null,method:"call",params:{timerId:t,timerType:i}}):e.set(t,setTimeout(o,r-s,e,t,r,i))};addEventListener("message",(i=>{let{data:s}=i;try{if("clear"===s.method){const{id:r,params:{timerId:o,timerType:i}}=s;if("interval"===i)(t=>{const r=e.get(t);if(void 0===r)throw new Error('There is no interval scheduled with the given id "'.concat(t,'".'));clearTimeout(r),e.delete(t)})(o),postMessage({error:null,id:r});else{if("timeout"!==i)throw new Error('The given type "'.concat(i,'" is not supported'));(e=>{const r=t.get(e);if(void 0===r)throw new Error('There is no timeout scheduled with the given id "'.concat(e,'".'));clearTimeout(r),t.delete(e)})(o),postMessage({error:null,id:r})}}else{if("set"!==s.method)throw new Error('The given method "'.concat(s.method,'" is not supported'));{const{params:{delay:i,now:n,timerId:a,timerType:d}}=s;if("interval"===d)((t,i,s)=>{const{expected:n,remainingDelay:a}=r(t,s);e.set(i,setTimeout(o,a,e,i,n,"interval"))})(i,a,n);else{if("timeout"!==d)throw new Error('The given type "'.concat(d,'" is not supported'));((e,i,s)=>{const{expected:n,remainingDelay:a}=r(e,s);t.set(i,setTimeout(o,a,t,i,n,"timeout"))})(i,a,n)}}}}catch(e){postMessage({error:{message:e.message},id:s.id,result:null})}}))})();`),Q=o=>D().clearInterval(o),Z=(o,e)=>D().setInterval(o,e);function F(o){return o.toString().padStart(2,"0")}class ee{constructor(){v(this,"minutes"),v(this,"seconds")}get time(){return`${F(this.minutes)}:${F(this.seconds)}`}reset(){this.minutes=1,this.seconds=36}tick(){this.seconds--,this.minutes>0&&this.seconds<0&&(this.seconds=59,this.minutes--),this.minutes===0&&this.seconds===0&&E.emit("timer_end"),E.emit("overlay_set_time",this.time)}}class te{constructor(){v(this,"interval"),v(this,"countdown",new ee)}reset(){this.stop(),this.start()}start(){this.countdown.reset(),E.emit("overlay_set_time",this.countdown.time),this.interval=Z(()=>{this.countdown.tick()},1e3)}stop(){this.interval&&(Q(this.interval),this.interval=null)}}class ie{constructor(){v(this,"el"),v(this,"time"),v(this,"container"),v(this,"draggable")}mount(e){this.draggable=e,this.time=m("time"),this.container=m("div",{className:"widget-container"},this.time),this.el=m("div",{className:"widget",onmouseenter:()=>{this.draggable.el.classList.add("moved")},onmouseleave:()=>{this.draggable.el.classList.remove("moved")},onauxclick:i=>{i.preventDefault(),E.emit("timer_reset")},oncontextmenu:i=>{i.preventDefault()}},this.container),this.timerIdle()}setTime(e){this.time.textContent=e}timerIdle(){this.setTime("IDLE"),this.el.classList.add("timer-idle")}timerEnded(){this.el.classList.add("timer-ended")}timerStarted(){this.el.classList.remove("timer-idle"),this.el.classList.remove("timer-ended")}}const ce="";class ne{constructor(){v(this,"draggable"),v(this,"widget"),v(this,"timer"),v(this,"clicker"),this.draggable=new $,this.widget=new ie,this.widget.mount(this.draggable),this.draggable.mount(this.widget.el),this.clicker=new R,this.clicker.mount(),this.timer=new te,E.on("timer_start",()=>{console.log("timer_start"),this.timer.start(),this.widget.timerStarted()}),E.on("timer_end",()=>{console.log("timer_end"),this.timer.stop(),this.widget.timerEnded()}),E.on("timer_reset",()=>{console.log("timer_reset"),this.timer.reset(),this.widget.timerStarted(),this.clicker.unmount(),this.clicker.mount()}),E.on("overlay_set_time",e=>{this.widget.setTime(e)})}}const se=new ne;console.log(se),GM_addStyle(".overlay{left:0;top:0;width:100%;height:100%;cursor:grab}.overlay.moved{position:fixed}.overlay.grabbing{cursor:grabbing}.overlay .widget{z-index:999999;position:fixed!important;background-color:#1f1f23;user-select:none;touch-action:none;width:64px;height:32px;box-shadow:0 6px 16px #00000080,0 0 4px #0006;border:1px solid rgba(255,255,255,.1);display:flex;flex-direction:column;align-items:center;justify-content:center}.overlay .widget-container{font-family:Segoe UI,Tahoma,Geneva,Verdana,sans-serif;font-weight:lighter;font-size:20px;color:#fff}.timer-ended{background-color:#e91e63!important}.timer-idle{background-color:#03a9f4!important}")})();
